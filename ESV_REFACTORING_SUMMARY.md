# Рефакторинг: Використання generateTemplateData для ЄСВ

## Зміни

### 1. `src/utils/templateUtils.ts`
- ✅ Додано імпорт `ESVReportData`
- ✅ Створено інтерфейс `ESVTemplateData` (аналогічний до `TemplateData`)
- ✅ Додано функцію `generateMonthsRows()` - генерує HTML рядки таблиці місяців
- ✅ Додано функцію `generateESVTemplateData()` - генерує дані для заповнення шаблону ЄСВ
- ✅ Зроблено `populateTemplate()` generic функцією для роботи з різними типами даних

### 2. `src/templates/esvPreviewTemplate.ts`
- ✅ Додано імпорт `ESVTemplateData` та `populateTemplate`
- ✅ Спрощено `fillESVPreviewTemplate()` - тепер використовує `populateTemplate`
- ✅ Додано `@deprecated` тег до старої функції (може бути видалена в майбутньому)

### 3. `src/components/ESVReportPreview.tsx`
- ✅ Оновлено імпорти: `generateESVTemplateData`, `populateTemplate`, `esvPreviewTemplate`
- ✅ Видалено ручне форматування дат та складання даних
- ✅ Використовується `generateESVTemplateData()` для підготовки даних
- ✅ Використовується `populateTemplate()` для заповнення шаблону

## Переваги рефакторингу

1. **Консистентність**: Обидва звіти (F0103309 та F0133109) тепер використовують однаковий підхід
2. **DRY principle**: Видалено дублювання коду для заповнення шаблонів
3. **Типобезпека**: Generic функція `populateTemplate` працює з різними типами даних
4. **Легше підтримувати**: Вся логіка генерації даних в одному місці (`templateUtils.ts`)
5. **Легше тестувати**: Функції `generateESVTemplateData` можна легко протестувати окремо

## ESVTemplateData поля

```typescript
{
  // Тип звіту
  HZ, HZN, HZU, HD
  
  // ІПН та ПІБ
  HTIN, HTINPF, HNAME
  
  // Період звітності
  H1KV, HHY, H3KV, HZM, HY, HZY
  
  // Період для уточнення
  H1KVP, HHYP, H3KVP, HYP, HZYP
  
  // Тип форми (NEW)
  H01, H02, H03, H04
  
  // Дата державної реєстрації припинення (NEW)
  R06G1, R06G2, R06G3
  
  // Код основного виду економічної діяльності (NEW)
  HKVED
  
  // Період перебування на спрощеній системі (NEW)
  R08G1D, R08G2D
  
  // Код категорії застрахованої особи (NEW)
  R081G1
  
  // Дані таблиці
  MONTHS_ROWS - HTML рядки з усіма місяцями та підсумком
  
  // Визначення зобов'язань із сплати ЄСВ - пункт 10 (NEW)
  R0101G3, R0102G3, R0103G3, R0104G3, R0105G3
  
  // Підпис
  HBOS, FILL_DATE
}
```

## Останнє оновлення (25.01.2026)

### Додано нові поля в ESVTemplateData:
- **H01-H04**: Тип форми (після припинення, призначення пенсії, перехід на інші податки, матеріальне забезпечення)
- **R06G1-R06G3**: Дата державної реєстрації припинення (число, місяць, рік)
- **HKVED**: Код основного виду економічної діяльності
- **R08G1D, R08G2D**: Період перебування на спрощеній системі оподаткування
- **R081G1**: Код категорії застрахованої особи (за замовчуванням "6" - ФОП на спрощеній системі)
- **R0101G3-R0105G3**: Поля для пункту 10 "Визначення зобов'язань із сплати єдиного внеску у зв'язку з виправленням самостійно виявлених помилок":
  - R0101G3: Сума ЄСВ за даними звітного періоду
  - R0102G3: Уточнена сума ЄСВ
  - R0103G3: Збільшення суми ЄСВ
  - R0104G3: Зменшення суми ЄСВ
  - R0105G3: Сума пені

Усі нові поля за замовчуванням мають порожні значення і заповнюються тільки за потреби (наприклад, для уточнюючих звітів, припинення діяльності, тощо).
  HBOS, FILL_DATE
}
```

## Як використовувати

```typescript
import { generateESVTemplateData, populateTemplate } from '../utils/templateUtils';
import { esvPreviewTemplate } from '../templates/esvPreviewTemplate';

// Генеруємо дані для шаблону
const templateData = generateESVTemplateData(profile, reportData);

// Заповнюємо HTML шаблон
const filledHTML = populateTemplate(esvPreviewTemplate, templateData);
```

## Зворотна сумісність

Стара функція `fillESVPreviewTemplate()` все ще працює, але помічена як `@deprecated`. Нові компоненти повинні використовувати новий підхід.
