# Звіт ЄСВ F0133109

Функціонал для генерації річного звіту про суми нарахованого єдиного внеску на загальнообов'язкове державне соціальне страхування (форма F0133109).

## Структура файлів

### Типи даних
- `src/types/index.ts` - додано інтерфейси:
  - `MonthESVSettings` - налаштування ЄСВ для одного місяця
  - `ESVSettings` - налаштування ЄСВ для року (12 місяців)
  - `ESVReportData` - дані для звіту ЄСВ
  - `TaxReportF0133109` - структура XML звіту F0133109

### Утиліти
- `src/utils/esvSettings.ts` - функції для роботи з налаштуваннями ЄСВ:
  - `createDefaultESVSettings()` - створення налаштувань з дефолтними значеннями
  - `loadESVSettings()` - завантаження налаштувань для року
  - `saveESVSettings()` - збереження налаштувань
  - `updateMonthSettings()` - оновлення налаштувань місяця
  - `updateMonthSettingsFrom()` - оновлення налаштувань починаючи з місяця
  - `calculateMonthESV()` - розрахунок ЄСВ для місяця
  - `calculateYearESV()` - розрахунок загальної суми ЄСВ за рік

- `src/utils/esvXmlGenerator.ts` - функції для генерації XML звіту:
  - `generateESVReportData()` - генерація даних звіту на основі налаштувань
  - `generateESVReport()` - перетворення даних у формат звіту
  - `generateESVXML()` - генерація XML для звіту F0133109
  - `downloadESVXML()` - завантаження XML файлу
  - `validateESVReport()` - валідація звіту перед генерацією

### Шаблони
- `src/templates/esvPreviewTemplate.ts` - примітивний HTML шаблон для preview:
  - `esvPreviewTemplate` - HTML шаблон
  - `fillESVPreviewTemplate()` - функція заповнення шаблону даними

### Компоненти
- `src/components/ESVSettingsModal.tsx` - модальне вікно налаштувань ЄСВ:
  - Таблиця з 12 місяцями
  - Поля для введення суми доходу та відсотка ЄСВ
  - Кнопка "Застосувати далі" для поширення значень на наступні місяці
  - Автоматичний розрахунок суми ЄСВ

- `src/components/ESVReportPreview.tsx` - компонент попереднього перегляду звіту

### Інтеграція в UI
- `src/pages/ReportsPage.tsx` - додано:
  - Секцію звіту ЄСВ (показується тільки для 4 кварталу)
  - Кнопки для налаштування, перегляду та генерації звіту F0133109
  - Діалоги для налаштувань та preview

- `src/pages/ConfigPage.tsx` - додано:
  - Секцію швидкого доступу до налаштувань ЄСВ
  - Вибір року та кнопка відкриття налаштувань

## Використання

### Налаштування ЄСВ

1. Перейдіть на сторінку "Налаштування" або "Звіти"
2. У секції "Налаштування ЄСВ" виберіть рік
3. Натисніть "Налаштувати ЄСВ для {рік} року"
4. У таблиці для кожного місяця встановіть:
   - Суму доходу на яку нараховується ЄСВ (по замовчуванню 8000 грн)
   - Відсоток ЄСВ (по замовчуванню 22%)
5. Використовуйте кнопку "Застосувати далі" щоб поширити значення на всі наступні місяці
6. Натисніть "Зберегти"

### Генерація звіту

1. Перейдіть на сторінку "Звіти"
2. Виберіть 4 квартал року (звіт ЄСВ річний)
3. У секції "Звіт ЄСВ F0133109":
   - Натисніть "Переглянути звіт ЄСВ" для попереднього перегляду
   - Натисніть "Згенерувати F0133109 XML" для завантаження XML файлу

## Дефолтні значення

- Сума доходу: **8000 грн** на місяць
- Відсоток ЄСВ: **22%**

Ці значення можна змінити для кожного місяця окремо.

## Структура XML звіту F0133109

Звіт генерується згідно зі схемою `src/templates/F0133109.xsd`:

```xml
<DECLAR>
  <DECLARHEAD>
    <!-- ІПН, тип документу, період тощо -->
  </DECLARHEAD>
  <DECLARBODY>
    <!-- Заголовок звіту -->
    <HZ>1</HZ>
    <HTIN>...</HTIN>
    <HNAME>...</HNAME>
    <HY>1</HY>  <!-- Звітний період - рік -->
    <HZY>2025</HZY>
    <HKVED>...</HKVED>
    
    <!-- Період перебування на спрощеній системі -->
    <R08G1D>01.01.2025</R08G1D>
    <R08G2D>31.12.2025</R08G2D>
    
    <!-- Дані по місяцях -->
    <R091G2>8000.00</R091G2>  <!-- Січень: сума доходу -->
    <R091G3>22.00</R091G3>     <!-- Січень: відсоток -->
    <R091G4>1760.00</R091G4>   <!-- Січень: сума ЄСВ -->
    
    <R092G2>8000.00</R092G2>  <!-- Лютий -->
    <R092G3>22.00</R092G3>
    <R092G4>1760.00</R092G4>
    
    <!-- ... інші місяці ... -->
    
    <!-- Підсумки -->
    <R09G2>96000.00</R09G2>   <!-- Загальна сума доходу -->
    <R09G4>21120.00</R09G4>   <!-- Загальна сума ЄСВ -->
    
    <HBOS>...</HBOS>  <!-- Підписант -->
  </DECLARBODY>
</DECLAR>
```

## Поля звіту

### Місячні дані (R09xxG2, R09xxG3, R09xxG4)

Для кожного місяця (01-12):
- **R09{NN}G2** - Самостійно визначена сума доходу, на яку нараховується єдиний внесок
- **R09{NN}G3** - Розмір єдиного внеску у відсотках
- **R09{NN}G4** - Сума єдиного внеску до сплати (G2 × G3 / 100)

Де {NN} - номер місяця: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12

### Підсумкові поля

- **R09G2** - Загальна сума доходу за рік (сума всіх R09xxG2)
- **R09G4** - Загальна сума ЄСВ за рік (сума всіх R09xxG4)

## Валідація

При генерації звіту перевіряється:
- ІПН містить 10 цифр
- Код податкової містить 4 цифри
- ПІБ заповнене
- Код КВЕДу заповнений
- Звіт містить дані за всі 12 місяців
- Суми доходів більші за 0
- Ставки ЄСВ в межах 0-100%

## Зберігання даних

Налаштування ЄСВ зберігаються в `localStorage` з ключем `fop-esv-settings`.

Структура:
```typescript
[
  {
    year: 2025,
    monthlySettings: [
      { month: 1, incomeBase: 8000, contributionRate: 22 },
      { month: 2, incomeBase: 8000, contributionRate: 22 },
      // ... інші місяці
    ]
  },
  // ... інші роки
]
```
